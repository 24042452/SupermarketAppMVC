<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<nav class="navbar navbar-expand-sm bg-dark navbar-dark shadow-sm">
  <div class="container-fluid">

    <!-- Brand -->
    <a class="navbar-brand fw-bold" href="/">Supermarket App</a>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Items -->
    <div class="collapse navbar-collapse" id="collapsibleNavbar">

      <ul class="navbar-nav ms-auto align-items-center">

        <!-- If logged in -->
        <% if (user) { %>

          <!-- Greeting -->
          <li class="nav-item me-3 text-white">
            Hello, <%= user.username %>
          </li>

          <!-- Cart Dropdown -->
          <li class="nav-item dropdown cart position-relative me-3">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-cart3"></i> Cart (<%= cart ? cart.length : 0 %>)
            </a>

            <div class="dropdown-menu dropdown-menu-end p-3 shadow rounded" style="min-width: 260px;">

              <% if (!cart || cart.length === 0) { %>

                <div class="text-center text-muted py-2">
                  Your cart is empty.
                </div>

              <% } else { %>

                <% let totalPrice = 0; %>

                <% cart.forEach(item => { 
                    totalPrice = totalPrice + (item.price * item.quantity); 
                %>

                  <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                    <div>
                      <div class="fw-semibold"><%= item.productName %></div>
                      <div class="text-muted small">Qty: <%= item.quantity %></div>
                    </div>
                    <div class="fw-bold text-success">
                      $<%= (item.price * item.quantity).toFixed(2) %>
                    </div>
                  </div>

                <% }) %>

                <!-- Total Price Section -->
                <div class="d-flex justify-content-between mt-2">
                  <span class="fw-bold">Total:</span>
                  <span class="fw-bold text-primary">$<%= totalPrice.toFixed(2) %></span>
                </div>

                <!-- View Cart Button -->
                <div class="mt-3 text-center">
                  <a href="/cart" class="btn btn-sm btn-primary w-100">View Cart</a>
                </div>

              <% } %>

            </div>
          </li>

          <!-- Logout -->
          <li class="nav-item">
            <a class="nav-link" href="/logout">Logout</a>
          </li>

        <% } else { %>

          <!-- Login -->
          <li class="nav-item">
            <a class="nav-link" href="/login">Login</a>
          </li>

          <!-- Register -->
          <li class="nav-item">
            <a class="nav-link" href="/register">Register</a>
          </li>

        <% } %>

      </ul>
    </div>
  </div>
</nav>

<style>
  /* Scrollbar for cart dropdown */
  .cart .dropdown-menu {
    max-height: 350px;
    overflow-y: auto;
  }

  .cart .dropdown-menu::-webkit-scrollbar {
    width: 6px;
  }

  .cart .dropdown-menu::-webkit-scrollbar-thumb {
    background: #cccccc;
    border-radius: 3px;
  }

  .navbar .dropdown-menu {
    animation: fadeIn 0.15s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>
