<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<nav class="navbar navbar-expand-sm shadow-sm" style="background: linear-gradient(90deg, #4b6cb7, #182848);">
  <div class="container-fluid">

    <!-- Brand -->
    <a class="navbar-brand fw-bold text-white fs-4" href="/">Dylan's Supermarket</a>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Items -->
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav ms-auto align-items-center">

        <% if (user) { %>

          <!-- Greeting -->
          <li class="nav-item me-4 text-white fw-semibold">
            Hello, <%= user.username %>
          </li>

          <!-- Cart Dropdown -->
          <li class="nav-item dropdown cart position-relative me-3">
            <a class="nav-link dropdown-toggle d-flex align-items-center cart-link" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-cart3 fs-5 me-1"></i>
              Cart (<%= cart ? cart.length : 0 %>)
            </a>

            <div class="dropdown-menu dropdown-menu-end p-3 shadow rounded-3" style="min-width: 280px; max-height: 400px; overflow-y: auto;">

              <% if (!cart || cart.length === 0) { %>
                <div class="text-center text-muted py-3">Your cart is empty.</div>
              <% } else { %>

                <% let totalPrice = 0; %>
                <% cart.forEach(item => { 
                    totalPrice = totalPrice + (item.price * item.quantity); 
                %>
                  <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
                    <div>
                      <div class="fw-semibold"><%= item.productName %></div>
                      <div class="text-muted small">Qty: <%= item.quantity %></div>
                    </div>
                    <div class="fw-bold text-success">$<%= (item.price * item.quantity).toFixed(2) %></div>
                  </div>
                <% }) %>

                <div class="d-flex justify-content-between mt-2 mb-3">
                  <span class="fw-bold">Total:</span>
                  <span class="fw-bold text-primary">$<%= totalPrice.toFixed(2) %></span>
                </div>

                <!-- Updated View Cart button -->
                <a href="/cart" class="btn btn-primary btn-sm w-100 rounded-pill">View Cart</a>
              <% } %>

            </div>
          </li>

          <!-- Order History -->
          <li class="nav-item me-3">
            <a class="nav-link text-white fw-semibold" href="/orders">Order History</a>
          </li>

          <!-- Logout -->
          <li class="nav-item">
            <a class="nav-link text-white fw-semibold btn btn-outline-light btn-sm rounded-pill px-3 logout-btn" href="/logout">Logout</a>
          </li>

        <% } else { %>

          <!-- Login -->
          <li class="nav-item me-2">
            <a class="nav-link text-white fw-semibold btn btn-outline-light btn-sm rounded-pill px-3" href="/login">Login</a>
          </li>

          <!-- Register -->
          <li class="nav-item">
            <a class="nav-link text-white fw-semibold btn btn-light btn-sm rounded-pill px-3" href="/register">Register</a>
          </li>

        <% } %>

      </ul>
    </div>
  </div>
</nav>

<style>
  /* Cart Scrollbar */
  .cart .dropdown-menu::-webkit-scrollbar {
    width: 6px;
  }

  .cart .dropdown-menu::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
  }

  /* Dropdown fade-in */
  .navbar .dropdown-menu {
    animation: fadeIn 0.2s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Cart color white */
  .cart-link {
    color: white !important;
  }

  .cart-link:hover {
    color: #ffd700 !important;
  }

  /* Logout button hover */
  .logout-btn {
    transition: all 0.3s ease;
  }

  .logout-btn:hover {
    background-color: #ffd700;
    border-color: transparent;
    color: #182848 !important;
  }

  /* Other links hover */
  .navbar-nav .nav-link:hover:not(.cart-link):not(.logout-btn) {
    color: #ffd700 !important;
  }
</style>
